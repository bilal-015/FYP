<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Interview Reports | InterviewAI</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css"
    />

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
      :root {
        --primary: #6366f1;
        --primary-light: #818cf8;
        --secondary: #8b5cf6;
        --light: #f8fafc;
        --dark: #0f172a;
        --darker: #0b1220;
        --gray: #94a3b8;
        --border: rgba(255, 255, 255, 0.08);
        --success: #10b981;
        --warning: #f59e0b;
        --danger: #ef4444;
        --card-bg: rgba(15, 23, 42, 0.8);
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Inter", "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      }

      body {
        background: linear-gradient(135deg, var(--darker), #1e293b);
        min-height: 100vh;
        color: #f8fafc;
        display: flex;
      }

      /* Sidebar Styles */
      .sidebar {
        width: 250px;
        background: var(--dark);
        height: 100vh;
        position: fixed;
        padding: 20px 0;
        border-right: 1px solid var(--border);
      }

      .sidebar-brand {
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 20px;
        margin-bottom: 30px;
      }

      .sidebar-brand i {
        font-size: 28px;
        background: linear-gradient(135deg, #a5b4fc, #c4b5fd);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        margin-right: 10px;
      }

      .sidebar-brand h2 {
        font-size: 22px;
        font-weight: 700;
        background: linear-gradient(135deg, #e0e7ff, #ede9fe);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
      }

      .sidebar-nav {
        list-style: none;
      }

      .sidebar-nav li {
        margin-bottom: 5px;
      }

      .sidebar-nav a {
        display: flex;
        align-items: center;
        padding: 12px 20px;
        color: #cbd5e1;
        text-decoration: none;
        transition: all 0.3s;
        border-left: 3px solid transparent;
      }

      .sidebar-nav a:hover,
      .sidebar-nav a.active {
        background: rgba(30, 41, 59, 0.6);
        color: #f8fafc;
        border-left: 3px solid var(--primary);
      }

      .sidebar-nav a i {
        margin-right: 12px;
        font-size: 18px;
        width: 24px;
        text-align: center;
      }

      /* Main Content */
      .main-content {
        flex: 1;
        margin-left: 250px;
        padding: 30px;
      }

      .header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 30px;
        padding-bottom: 20px;
        border-bottom: 1px solid var(--border);
      }

      .user-menu {
        display: flex;
        align-items: center;
      }

      .user-menu img {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        margin-right: 12px;
        object-fit: cover;
        border: 2px solid var(--primary);
      }
      /* Filters */
      .filters {
        display: flex;
        gap: 15px;
        margin-bottom: 20px;
        flex-wrap: wrap;
      }

      .search-box {
        position: relative;
        flex: 1;
        min-width: 250px;
      }

      .search-box input {
        width: 100%;
        padding: 12px 15px 12px 40px;
        background: rgba(30, 41, 59, 0.6);
        border: 1px solid var(--border);
        border-radius: 12px;
        color: #f8fafc;
      }

      .search-box i {
        position: absolute;
        left: 15px;
        top: 50%;
        transform: translateY(-50%);
        color: var(--gray);
      }

      .filter-select {
        padding: 12px 15px;
        background: rgba(30, 41, 59, 0.6);
        border: 1px solid var(--border);
        border-radius: 12px;
        color: #f8fafc;
        min-width: 150px;
      }

      /* Content Sections */
      .content-section {
        background: var(--card-bg);
        border-radius: 16px;
        padding: 25px;
        margin-bottom: 30px;
        border: 1px solid var(--border);
        backdrop-filter: blur(10px);
      }

      .section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
      }

      .section-title {
        font-size: 18px;
        font-weight: 600;
      }

      .btn {
        padding: 10px 20px;
        border-radius: 12px;
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        color: white;
        border: none;
        cursor: pointer;
        font-weight: 500;
        display: inline-flex;
        align-items: center;
        gap: 8px;
      }

      /* Tables */
      .table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 15px;
      }

      .table th,
      .table td {
        padding: 12px 15px;
        text-align: left;
        border-bottom: 1px solid var(--border);
      }

      .table th {
        color: var(--gray);
        font-weight: 500;
        font-size: 14px;
      }

      .badge {
        padding: 5px 10px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 500;
      }

      .badge-success {
        background: rgba(16, 185, 129, 0.15);
        color: var(--success);
      }

      .badge-warning {
        background: rgba(245, 158, 11, 0.15);
        color: var(--warning);
      }

      .badge-danger {
        background: rgba(239, 68, 68, 0.15);
        color: var(--danger);
      }

      .action-buttons {
        display: flex;
        gap: 10px;
      }

      .btn-icon {
        width: 32px;
        height: 32px;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: rgba(30, 41, 59, 0.6);
        border: 1px solid var(--border);
        color: #cbd5e1;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .btn-icon:hover {
        background: rgba(99, 102, 241, 0.15);
        color: var(--primary);
      }

      .btn-download:hover {
        background: rgba(16, 185, 129, 0.15);
        color: var(--success);
      }

      .btn-delete:hover {
        background: rgba(239, 68, 68, 0.15);
        color: var(--danger);
      }

      /* Pagination */
      .pagination {
        display: flex;
        justify-content: center;
        gap: 10px;
        margin-top: 20px;
      }

      .pagination-item {
        width: 36px;
        height: 36px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 8px;
        background: rgba(30, 41, 59, 0.6);
        color: #cbd5e1;
        text-decoration: none;
        transition: all 0.3s ease;
        cursor: pointer;
      }

      .pagination-item:hover,
      .pagination-item.active {
        background: var(--primary);
        color: white;
      }

      .pagination-item.disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }

      /* Loading indicator */
      .loading {
        display: inline-block;
        width: 20px;
        height: 20px;
        border: 3px solid rgba(255, 255, 255, 0.3);
        border-radius: 50%;
        border-top-color: #fff;
        animation: spin 1s ease-in-out infinite;
        margin-right: 10px;
      }

      /* Modal */
      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.7);
        z-index: 1000;
        align-items: center;
        justify-content: center;
      }

      .modal-content {
        background: var(--card-bg);
        border-radius: 16px;
        padding: 30px;
        width: 90%;
        max-width: 500px;
        border: 1px solid var(--border);
        backdrop-filter: blur(10px);
      }

      .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
      }

      .modal-title {
        font-size: 20px;
        font-weight: 600;
      }

      .modal-close {
        background: none;
        border: none;
        color: var(--gray);
        font-size: 24px;
        cursor: pointer;
      }

      .modal-body {
        margin-bottom: 20px;
      }

      .modal-footer {
        display: flex;
        justify-content: flex-end;
        gap: 10px;
      }

      .btn-cancel {
        background: rgba(30, 41, 59, 0.6);
        color: #cbd5e1;
        border: 1px solid var(--border);
      }

      .btn-confirm {
        background: var(--danger);
        color: white;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      /* Responsive */
      @media (max-width: 992px) {
        .sidebar {
          width: 80px;
        }
        .sidebar-brand h2,
        .sidebar-nav span {
          display: none;
        }
        .sidebar-nav a {
          justify-content: center;
          padding: 15px;
        }
        .sidebar-nav a i {
          margin-right: 0;
        }
        .main-content {
          margin-left: 80px;
        }
      }

      @media (max-width: 768px) {
        .filters {
          flex-direction: column;
        }
        .main-content {
          padding: 20px;
        }
        .pagination {
          flex-wrap: wrap;
        }
      }
    </style>
  </head>
  <body>
    <!-- Sidebar -->
    <div class="sidebar">
      <div class="sidebar-brand">
        <i class="fas fa-robot"></i>
        <h2>InterviewAI</h2>
      </div>
      <ul class="sidebar-nav">
        <li>
          <a href="{%url 'admin_dashboard'%}"
            ><i class="fas fa-tachometer-alt"></i> <span>Dashboard</span></a
          >
        </li>
        <li>
          <a href="{%url 'candidates_management'%}"
            ><i class="fas fa-users"></i> <span>Candidates</span></a
          >
        </li>
        <li>
          <a href="" class="active"
            ><i class="fas fa-file-alt"></i> <span>Reports</span></a
          >
        </li>
        <li>
          <a href="{%url 'logs_management'%}"
            ><i class="fas fa-clipboard-list"></i> <span>System Logs</span></a
          >
        </li>
        <li>
          <a href="{% url 'mcqs_management'%}">
            <i class="fas fa-book"></i> <span>MCQs</span>
          </a>
        </li>
        <li>
          <a href="{%url 'logout'%}"
            ><i class="fas fa-sign-out-alt"></i> <span>Logout</span></a
          >
        </li>
      </ul>
    </div>

    <!-- Main Content -->
    <div class="main-content">
      <div class="header">
        <h1>Interview Reports</h1>
        <div class="user-menu">
          <img src="{{request.session.admin_image}}" alt="" />
          <div>
            <div>{{request.session.admin_full_name}}</div>
            <small>Super Administrator</small>
          </div>
        </div>
      </div>

      <!-- Filters -->
      <div class="filters">
        <div class="search-box">
          <i class="fas fa-search"></i>
          <input type="text" id="searchInput" placeholder="Search reports..." />
        </div>
        <select class="filter-select" id="technologyFilter">
          <option value="">All Technologies</option>
          <option value="Python">Python</option>
          <option value="JavaScript">JavaScript</option>
          <option value="Java">Java</option>
          <option value="React">React</option>
          <option value="Node.js">Node.js</option>
        </select>
        <select class="filter-select" id="difficultyFilter">
          <option value="">All Difficulty</option>
          <option value="Easy">Easy</option>
          <option value="Medium">Medium</option>
          <option value="Hard">Hard</option>
        </select>
        <button class="btn" id="applyFilters">
          <i class="fas fa-filter"></i> Apply Filters
        </button>
        <button class="btn" id="resetFilters">
          <i class="fas fa-redo"></i> Reset
        </button>
      </div>

      <!-- Reports Table -->
      <div class="content-section">
        <div class="section-header">
          <h2 class="section-title">All Interview Reports</h2>
          <button class="btn" id="refreshData">
            <i class="fas fa-sync-alt"></i> Refresh Data
          </button>
        </div>
        <div class="table-responsive">
          <table class="table">
            <thead>
              <tr>
                <th>Report ID</th>
                <th>Candidate</th>
                <th>Date</th>
                <th>Technology</th>
                <th>Difficulty</th>
                <th>Score</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="reportsTableBody">
              <tr>
                <td colspan="7" style="text-align: center">
                  <div class="loading"></div>
                  Loading reports...
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- Pagination -->
        <div class="pagination" id="pagination">
          <!-- Pagination will be generated by JavaScript -->
        </div>
      </div>
    </div>

    <!-- View Report Modal (would appear when eye icon is clicked) -->
    <div id="viewModal" style="display: none">
      <!-- Modal content would be generated by JavaScript -->
    </div>

    <!-- Delete Confirmation Modal -->
    <div class="modal" id="deleteModal">
      <div class="modal-content">
        <div class="modal-header">
          <h2 class="modal-title">Confirm Delete</h2>
          <button class="modal-close" id="closeDeleteModal">&times;</button>
        </div>
        <div class="modal-body">
          <p>
            Are you sure you want to delete this report? This action cannot be
            undone.
          </p>
        </div>
        <div class="modal-footer">
          <button class="btn btn-cancel" id="cancelDelete">Cancel</button>
          <button class="btn btn-confirm" id="confirmDelete">Delete</button>
        </div>
      </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
    <script>
      // Initialize toastr
      toastr.options = {
        positionClass: "toast-bottom-right",
        progressBar: true,
        timeOut: 3000,
      };

      window.jsPDF = window.jspdf.jsPDF;
      const deleteModal = document.getElementById("deleteModal");
      const closeDeleteModal = document.getElementById("closeDeleteModal");
      const confirmDelete = document.getElementById("confirmDelete");
      const cancelDelete = document.getElementById("cancelDelete");

      let reportToDelete = null;
      let reportToView = null;
      let reportToDownload = null;

      // Store the current filtered data
      let filteredReports = [];
      let currentPage = 1;
      const itemsPerPage = 5;

      // Helper function to fetch csrf token from cookies
      function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== "") {
          const cookies = document.cookie.split(";");
          for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === name + "=") {
              cookieValue = decodeURIComponent(
                cookie.substring(name.length + 1)
              );
              break;
            }
          }
        }
        return cookieValue;
      }

      function fetchReports() {
        document.getElementById("reportsTableBody").innerHTML = `
    <tr>
      <td colspan="7" style="text-align: center;">
        <div class="loading"></div> Loading reports...
      </td>
    </tr>
  `;

        return fetch("/get_reports/")
          .then((response) => response.json())
          .then((data) => {
            if (!data || data.length === 0) {
              return []; // no reports found
            }
            return data.map((report) => ({
              id: report.id,
              candidate: report.candidate,
              date: report.date,
              technology: report.technology,
              difficulty: report.difficulty,
              score: report.score,
            }));
          })
          .catch((error) => {
            return [];
          });
      }

      // Function to render reports table with pagination
      function renderReports(reports, page = 1) {
        const tbody = document.getElementById("reportsTableBody");

        if (!reports || reports.length === 0) {
          tbody.innerHTML =
            '<tr><td colspan="7" style="text-align: center;">No reports found matching your criteria.</td></tr>';
          document.getElementById("pagination").innerHTML = "";
          return;
        }

        // Calculate pagination details
        const totalPages = Math.ceil(reports.length / itemsPerPage);
        const startIndex = (page - 1) * itemsPerPage;
        const endIndex = Math.min(startIndex + itemsPerPage, reports.length);
        const paginatedReports = reports.slice(startIndex, endIndex);

        let html = "";

        paginatedReports.forEach((report) => {
          html += `
          <tr data-id="${report.id}">
            <td>${report.id}</td>
            <td>${report.candidate}</td>
            <td>${report.date}</td>
            <td>${report.technology}</td>
            <td>${report.difficulty}</td>
            <td>${report.score}%</td>
            <td>
              <div class="action-buttons">
                <button class="btn-icon btn-view" data-id="${report.id}"><i class="fas fa-eye"></i></button>
                <button class="btn-icon btn-download" data-id="${report.id}"><i class="fas fa-download"></i></button>
                <button class="btn-icon btn-delete" data-id="${report.id}"><i class="fas fa-trash"></i></button>
              </div>
            </td>
          </tr>
        `;
        });

        tbody.innerHTML = html;

        // Render pagination controls
        renderPagination(reports.length, page);

        // Add event listeners to the buttons
        document.querySelectorAll(".btn-view").forEach((btn) => {
          btn.addEventListener("click", handleViewReport);
        });

        document.querySelectorAll(".btn-delete").forEach((btn) => {
          btn.addEventListener("click", handleDeleteReport);
        });
      }

      // Function to render pagination controls
      function renderPagination(totalItems, currentPage) {
        const totalPages = Math.ceil(totalItems / itemsPerPage);
        const paginationContainer = document.getElementById("pagination");

        if (totalPages <= 1) {
          paginationContainer.innerHTML = "";
          return;
        }

        let html = "";

        // Previous button
        html += `
        <div class="pagination-item ${currentPage === 1 ? "disabled" : ""}" 
             onclick="${
               currentPage !== 1 ? `changePage(${currentPage - 1})` : ""
             }">
          <i class="fas fa-chevron-left"></i>
        </div>
      `;

        // Page numbers
        const maxVisiblePages = 5;
        let startPage = Math.max(
          1,
          currentPage - Math.floor(maxVisiblePages / 2)
        );
        let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);

        if (endPage - startPage + 1 < maxVisiblePages) {
          startPage = Math.max(1, endPage - maxVisiblePages + 1);
        }

        for (let i = startPage; i <= endPage; i++) {
          html += `
          <div class="pagination-item ${
            i === currentPage ? "active" : ""
          }" onclick="changePage(${i})">
            ${i}
          </div>
        `;
        }

        // Next button
        html += `
        <div class="pagination-item ${
          currentPage === totalPages ? "disabled" : ""
        }" 
             onclick="${
               currentPage !== totalPages
                 ? `changePage(${currentPage + 1})`
                 : ""
             }">
          <i class="fas fa-chevron-right"></i>
        </div>
      `;

        paginationContainer.innerHTML = html;
      }

      // Function to change page
      function changePage(page) {
        currentPage = page;
        renderReports(filteredReports, currentPage);

        // Scroll to top of table
        document
          .querySelector(".table-responsive")
          .scrollIntoView({ behavior: "smooth" });
      }

      // Function to filter reports based on criteria
      function filterReports() {
        const searchText = document
          .getElementById("searchInput")
          .value.toLowerCase();
        const technology = document.getElementById("technologyFilter").value;
        const difficulty = document.getElementById("difficultyFilter").value;

        filteredReports = mockReports.filter((report) => {
          // Search filter
          const matchesSearch =
            report.candidate.toLowerCase().includes(searchText) ||
            report.technology.toLowerCase().includes(searchText) ||
            report.id.toString().includes(searchText);

          // Technology filter
          const matchesTechnology =
            technology === "" || report.technology === technology;

          // Difficulty filter
          const matchesDifficulty =
            difficulty === "" || report.difficulty === difficulty;

          return matchesSearch && matchesTechnology && matchesDifficulty;
        });

        // Reset to first page when filtering
        currentPage = 1;
        renderReports(filteredReports, currentPage);
      }

      // Event handler for view report
      function handleViewReport(e) {
        const reportId = e.currentTarget.getAttribute("data-id");
        window.location.href = `/report_detail/${reportId}/`;
      }

      // Event handler for download report
      function handleDownloadReport(e) {
        const reportId = e.currentTarget.getAttribute("data-id");
        const report = mockReports.find((r) => r.id == reportId);

        toastr.info(`Downloading report #${reportId} for ${report.candidate}`);

        // Simulate download
        setTimeout(() => {
          toastr.success(`Report #${reportId} downloaded successfully`);
        }, 1500);
      }

      // Event handler for delete report
      function handleDeleteReport(e) {
        const reportId = e.currentTarget.getAttribute("data-id");
        reportToDelete = reportId;
        deleteModal.style.display = "flex";
      }

      // Confirm delete
      function confirmDeleteReport() {
        fetch("/delete-report/", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "X-CSRFToken": getCookie("csrftoken"), // Django CSRF protection
          },
          body: JSON.stringify({
            id: reportToDelete,
          }),
        })
          .then((response) => response.json())
          .then((data) => {
            if (data.success) {
              showToast("Report deleted successfully!", "success");
              setTimeout(() => {}, 1500); // wait so toast show
            } else {
              showToast("Error: " + data.error, "error");
            }
          })
          .catch((error) => {
            showToast("Error deleting report", "error");
          });

        deleteModal.style.display = "none";
        reportToDelete = null;
        // refresh the reports list
        document.getElementById("refreshData").click();
      }

      // Initialize the page
      document.addEventListener("DOMContentLoaded", async function () {
        // Fetch and render initial data
        mockReports = await fetchReports();
        filteredReports = [...mockReports];
        renderReports(filteredReports, currentPage);

        // Set up event listeners for filters
        document
          .getElementById("applyFilters")
          .addEventListener("click", filterReports);

        document
          .getElementById("resetFilters")
          .addEventListener("click", function () {
            document.getElementById("searchInput").value = "";
            document.getElementById("technologyFilter").value = "";
            document.getElementById("difficultyFilter").value = "";
            filterReports();
          });

        document
          .getElementById("refreshData")
          .addEventListener("click", async function () {
            mockReports = await fetchReports();

            filteredReports = [...mockReports];
            renderReports(filteredReports, currentPage);
          });

        // Add real-time search as user types
        document
          .getElementById("searchInput")
          .addEventListener("input", filterReports);

        // Add change events to filter dropdowns
        document
          .getElementById("technologyFilter")
          .addEventListener("change", filterReports);
        document
          .getElementById("difficultyFilter")
          .addEventListener("change", filterReports);

        // Modal events
        closeDeleteModal.addEventListener("click", function () {
          deleteModal.style.display = "none";
        });

        cancelDelete.addEventListener("click", function () {
          deleteModal.style.display = "none";
          candidateToDelete = null;
        });

        confirmDelete.addEventListener("click", confirmDeleteReport);

        // Generate PDF from report data
        function generatePDF(reportId) {
          const tempContainer = document.createElement("div");
          tempContainer.style.position = "absolute";
          tempContainer.style.left = "-9999px";
          tempContainer.style.top = "-9999px";
          tempContainer.style.width = "1200px";
          document.body.appendChild(tempContainer);

          fetch(`/report_detail/${reportId}/`)
            .then((response) => response.text())
            .then((html) => {
              tempContainer.innerHTML = html;
              const reportContent =
                tempContainer.querySelector(".report-container");

              // 🔹 Replace ALL chart canvases with images BEFORE html2canvas
              const canvasCharts = reportContent.querySelectorAll("canvas");
              canvasCharts.forEach((canvas) => {
                try {
                  const imgData = canvas.toDataURL("image/png");
                  const img = document.createElement("img");
                  img.src = imgData;
                  img.style.maxWidth = "100%";
                  canvas.replaceWith(img);
                } catch (err) {
                  console.error("Canvas replacement failed:", err);
                }
              });

              // 🔹 Now take screenshot with html2canvas
              html2canvas(reportContent).then((canvas) => {
                const imgData = canvas.toDataURL("image/png");
                const pdf = new jsPDF({
                  orientation: "portrait",
                  unit: "mm",
                  format: "a4",
                });

                const imgWidth = 210;
                const pageHeight = 297;
                const imgHeight = (canvas.height * imgWidth) / canvas.width;

                let renderHeight = imgHeight;
                let renderWidth = imgWidth;

                if (imgHeight > pageHeight) {
                  renderHeight = pageHeight;
                  renderWidth = (canvas.width * renderHeight) / canvas.height;
                }

                pdf.addImage(imgData, "PNG", 0, 0, renderWidth, renderHeight);
                pdf.save(`Interview_Report_${reportId}.pdf`);

                document.body.removeChild(tempContainer);
              });
            })
            .catch((err) => {
              document.body.removeChild(tempContainer);
            });
        }

        // Add event listeners to all download buttons
        document.querySelectorAll(".btn-download").forEach((button) => {
          button.addEventListener("click", function (e) {
            const reportId = e.currentTarget.getAttribute("data-id");

            // Show loading state on button
            const originalHTML = this.innerHTML;
            this.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';

            if (reportId) {
              // Simulate a short delay to show the spinner
              setTimeout(() => {
                generatePDF(reportId);

                // Restore button after a short delay
                setTimeout(() => {
                  this.innerHTML = originalHTML;
                }, 1000);
              }, 800);
            } else {
              alert("Report data not found!");
              this.innerHTML = originalHTML;
            }
          });
        });
      });
    </script>
  </body>
</html>
